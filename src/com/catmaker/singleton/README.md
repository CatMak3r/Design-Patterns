# å•ä¾‹æ¨¡å¼

é‡‡å–ä¸€å®šæ–¹å¼ä¿è¯åœ¨æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå¯¹æŸä¸ªç±»åªèƒ½å­˜åœ¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œå¹¶ä¸”è¯¥ç±»åªæä¾›ä¸€ä¸ªå–å¾—å…¶å¯¹è±¡ç¤ºä¾‹çš„æ–¹æ³•ï¼ˆé™æ€æ–¹æ³•ï¼‰



### ğŸ‘ğŸ»é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰

æ­¥éª¤ï¼š

1. æ„é€ å™¨ç§æœ‰åŒ–ï¼ˆé˜²æ­¢newï¼‰
2. ç±»çš„å†…éƒ¨åˆ›å»ºå¯¹è±¡
3. å‘å¤–æš´éœ²ä¸€ä¸ªé™æ€çš„å…¬å…±æ–¹æ³•ï¼ˆgetInstanceï¼‰



```java
public class Singleton {
    //1. æ„é€ å™¨ç§æœ‰åŒ–
    private Singleton() {}
    
    //2. ç±»çš„å†…éƒ¨åˆ›å»ºå¯¹è±¡
    private final static Singleton instance = new Singleton();
    
    //3. å¯¹å¤–æä¾›ä¸€ä¸ªé™æ€çš„å…¬å…±æ–¹æ³•
    public static Singleton getInstance() {
        return instance;
    }
}
```

#### ä¼˜ç‚¹

å†™æ³•ç®€å•ï¼Œåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜

#### ç¼ºç‚¹

å› ä¸ºç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loadingçš„æ•ˆæœã€‚å¦‚æœä»å§‹è‡³ç»ˆéƒ½æ²¡ç”¨è¿‡è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå†…å­˜çš„æµªè´¹



æœ‰å¯èƒ½å‡ºç°getInstanceä»¥å¤–çš„æ–¹å¼è£…è½½è¯¥ç±»

è¿™ç§å•ä¾‹æ¨¡å¼å¯ç”¨ï¼Œå¯èƒ½é€ æˆå†…å­˜æµªè´¹



### ğŸ‘ğŸ»é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰



```java
public class Singleton {
    private Singleton() {}
    private static Singleton instance;
    static {
        instance = new Singleton();
    }
    public static Singleton getInstance() {
        return instance;
    }
}
```

ä¼˜ç¼ºç‚¹ä¸ä¸Šä¸€ç§ç›¸åŒ



### æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰



```java
public class Singleton {
    private Singleton() {}
    private static Singleton instance;
    public static Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

#### ä¼˜ç¼ºç‚¹

èµ·åˆ°äº†Lazy Loadingçš„æ•ˆæœï¼Œä½†æ˜¯åªèƒ½åœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨ã€‚

ä½†æ˜¯å¦‚æœåœ¨å¤šçº¿ç¨‹çš„æ¡ä»¶ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ­£åœ¨åˆ¤æ–­if (instance == null)ï¼Œè€Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åæ¥å±…ä¸Šé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­ï¼Œè¿™æ˜¯å°±ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸è¦ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚



### æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•ï¼‰



```java
public class Singleton {
    private Singleton() {}
    private static Singleton instance;
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

#### ä¼˜ç¼ºç‚¹è¯´æ˜

1. è§£å†³äº†çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜
2. æ•ˆç‡å¤ªä½ã€‚æ¯ä¸ªçº¿ç¨‹åœ¨æƒ³è¦è·å–å®ä¾‹ï¼Œè°ƒç”¨getInstanceæ–¹æ³•çš„æ—¶å€™éƒ½éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚ç„¶ågetInstanceæ–¹æ³•åªéœ€è¦æ‰§è¡Œä¸€æ¬¡å°±å¯ä»¥ï¼Œåé¢å†éœ€è¦è¯¥ç±»å®ä¾‹ï¼Œç›´æ¥returnå³å¯ã€‚è¯¥æ–¹æ³•æ•ˆç‡å¤ªä½
3. åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸æ¨èä½¿ç”¨è¿™ç§æ–¹æ³•



### æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—ï¼‰

å’Œä¸Šé¢ä¸€ç§ç›¸åŒã€‚

```java
public class Singleton {
    private Singleton() {}
    private static Singleton instance;
    public static Singleton getInstance() {
        synchronized(Singleton.class) {
            if (instance == null) {
                instance = new Singleton();
            }
        }
        return instance;
    }
    
}
```



### ğŸ‘ğŸ»åŒé‡æ£€æŸ¥



```java
public class Singleton {
    private Singleton() {}
    private static volatile Singleton instance;
    public static Singleton getInstance() {
        if (instance == null) {
            synchronized(Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return Singleton
    }
}
```

#### ä¼˜ç¼ºç‚¹è¯´æ˜

1. ä¿è¯äº†çº¿ç¨‹å®‰å…¨
2. é˜²æ­¢å®ä¾‹åŒ–å¤šæ¬¡ã€‚åœ¨ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–ä»¥åï¼Œä¹‹ågetInstanceåœ¨ç¬¬ä¸€ä¸ªif (instance == null)å°±returnäº†ï¼Œä¸ç”¨å†è¿›è¡ŒåŒæ­¥

æ€»ç»“ï¼šçº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½ï¼Œæ•ˆç‡è¾ƒé«˜

åœ¨å®é™…å¼€å‘ä¸­æ¨èä½¿ç”¨è¿™ç§å•ä¾‹æ¨¡å¼



### ğŸ‘ğŸ»é™æ€å†…éƒ¨ç±»

- åœ¨Singletonè¢«è£…è½½çš„æ—¶å€™ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸ä¼šè¢«è£…è½½çš„
- åœ¨è°ƒç”¨getInstanceçš„æ—¶å€™ä¼šè£…è½½SingletonInstanceï¼Œç±»åœ¨è£…è½½çš„æ—¶å€™æ˜¯çº¿ç¨‹å®‰å…¨çš„

```java
public class Singleton {
    // åœ¨Singletonè¢«è£…è½½çš„æ—¶å€™ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸ä¼šè¢«è£…è½½çš„
    // åœ¨è°ƒç”¨getInstanceçš„æ—¶å€™ä¼šè£…è½½SingletonInstanceï¼Œç±»åœ¨è£…è½½çš„æ—¶å€™æ˜¯çº¿ç¨‹å®‰å…¨çš„
    private Singleton() {}
    private static class SingletonInstance {
        private static final Singleton INSTANCE = new Singleton();   
    }
    public static Singleton() {
        return SingletonInstance.INSTANCE;   
    }
}
```

#### ä¼˜ç¼ºç‚¹è¯´æ˜

1. é‡‡ç”¨ç±»è£…è½½çš„æœºåˆ¶ä¿è¯åˆå§‹åŒ–å®ä¾‹æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹
2. é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨Singletonç±»è¢«è£…è½½çš„æ—¶å€™å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨getInstanceæ–¹æ³•æ—¶ï¼Œæ‰ä¼šè£…è½½SingletonInstanceç±»ä»è€Œå®ŒæˆSingletonçš„å®ä¾‹åŒ–ã€‚
3. ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ã€‚æ‰€ä»¥JVMå¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»çš„åˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚
4. ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œåˆ©ç”¨é™æ€å†…éƒ¨ç±»ç‰¹ç‚¹å®ç°å»¶è¿ŸåŠ è½½ï¼Œæ•ˆç‡é«˜
5. **æ¨èä½¿ç”¨**



### ğŸ‘ğŸ»æšä¸¾



```java
enum Singleton {
    INSTANCE;
}
```

#### ä¼˜ç¼ºç‚¹åˆ†æ

1. ä¸ä»…èƒ½å¤Ÿ**é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜**ï¼Œè€Œä¸”è¿˜å¯ä»¥**é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡**ã€‚
2. è¿™ç§æ–¹å¼æ˜¯*Effective Java*ä½œè€…*Josh Blosh*æå€¡çš„æ–¹å¼
3. **æ¨èä½¿ç”¨**



### å•ä¾‹æ¨¡å¼åœ¨JDKåº”ç”¨çš„æºç åˆ†æ

åœ¨JDKä¸­ï¼Œjava.lang.Runtimeå°±æ˜¯ç»å…¸çš„å•ä¾‹æ¨¡å¼ï¼ˆé¥¿æ±‰å¼ï¼‰

![image.png](https://cdn.nlark.com/yuque/0/2020/png/701218/1582732256111-b96aceef-c93e-4508-b385-d664a0ec957b.png)

### *å•ä¾‹æ¨¡å¼æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜*

1. å•ä¾‹æ¨¡å¼ä¿è¯äº†ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›**éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡**ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½
2. å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯new
3. å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯ï¼š

1. 1. éœ€è¦**é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯**çš„å¯¹è±¡
   2. åˆ›å»ºå¯¹è±¡æ—¶**è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤š**ï¼ˆé‡é‡çº§å¯¹è±¡ï¼‰ï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡
   3. **å·¥å…·ç±»**å¯¹è±¡
   4. **é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶**çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ•°æ®æºï¼Œsessionå·¥å‚ç­‰ï¼‰